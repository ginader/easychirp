(function(e,t,n){"use strict";function o(t,n){this.element=t;this.settings=e.extend({},i,n);this._defaults=i;this._name=r;this.mouseTimeoutID=null;this.focusTimeoutID=null;this.mouseFocused=false;this.justFocused=false;this.init()}function u(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return e.css(this,"visibility")==="hidden"}).length}function a(t,n){var r,i,s,o=t.nodeName.toLowerCase();if("area"===o){r=t.parentNode;i=r.name;if(!t.href||!i||r.nodeName.toLowerCase()!=="map"){return false}s=e("img[usemap=#"+i+"]")[0];return!!s&&u(s)}return(/input|select|textarea|button|object/.test(o)?!t.disabled:"a"===o?t.href||n:n)&&u(t)}var r="accessibleMegaMenu",i={uuidPrefix:"accessible-megamenu",menuClass:"accessible-megamenu",topNavItemClass:"accessible-megamenu-top-nav-item",panelClass:"accessible-megamenu-panel",panelGroupClass:"accessible-megamenu-panel-group",hoverClass:"hover",focusClass:"focus",openClass:"open"},s={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38,keyMap:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",190:"."}};o.prototype=function(){var i=0,u=1e3,a="",f=typeof t.hasOwnProperty==="function"&&!!t.hasOwnProperty("ontouchstart"),l,c,h,p,d,v,m,g,y,b,w,E,S;l=function(t){return e(t).closest(":data(plugin_"+r+")").data("plugin_"+r)};c=function(t){t=e(t);var n=this.settings;if(!t.attr("id")){t.attr("id",n.uuidPrefix+"-"+(new Date).getTime()+"-"+ ++i)}};h=function(t,r){var i=e(t.target),o=this,u=this.settings,a=this.menu,f=i.closest("."+u.topNavItemClass),l=i.hasClass(u.panelClass)?i:i.closest("."+u.panelClass),c;S.call(this,r);e("html").off("mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu, pointerup.outside-accessible-megamenu",d);a.find("[aria-expanded]."+this.settings.panelClass).off("DOMAttrModified.accessible-megamenu");if(r){f=a.find("."+u.topNavItemClass+" ."+u.openClass+":first").closest("."+u.topNavItemClass);if(!(f.is(t.relatedTarget)||f.has(t.relatedTarget).length>0)){if((t.type==="mouseout"||t.type==="focusout")&&f.has(n.activeElement).length>0){return}f.find("[aria-expanded]").attr("aria-expanded","false").removeClass(u.openClass).filter("."+u.panelClass).attr("aria-hidden","true");if(t.type==="keydown"&&t.keyCode===s.ESCAPE||t.type==="DOMAttrModified"){c=f.find(":tabbable:first");setTimeout(function(){a.find("[aria-expanded]."+o.settings.panelClass).off("DOMAttrModified.accessible-megamenu");c.focus();o.justFocused=false},99)}}else if(f.length===0){a.find("[aria-expanded=true]").attr("aria-expanded","false").removeClass(u.openClass).filter("."+u.panelClass).attr("aria-hidden","true")}}else{clearTimeout(o.focusTimeoutID);f.siblings().find("[aria-expanded]").attr("aria-expanded","false").removeClass(u.openClass).filter("."+u.panelClass).attr("aria-hidden","true");f.find("[aria-expanded]").attr("aria-expanded","true").addClass(u.openClass).filter("."+u.panelClass).attr("aria-hidden","false");if(t.type==="mouseover"&&i.is(":tabbable")&&f.length===1&&l.length===0&&a.has(n.activeElement).length>0){i.focus();o.justFocused=false}S.call(o)}};p=function(t){var n=e(t.target),r=n.closest("."+this.settings.topNavItemClass),i=n.closest("."+this.settings.panelClass);if(r.length===1&&i.length===0&&r.find("."+this.settings.panelClass).length===1){if(!n.hasClass(this.settings.openClass)){t.preventDefault();t.stopPropagation();h.call(this,t)}else{if(this.justFocused){t.preventDefault();t.stopPropagation();this.justFocused=false}else if(f){t.preventDefault();t.stopPropagation();h.call(this,t,n.hasClass(this.settings.openClass))}}}};d=function(t){if(this.menu.has(e(t.target)).length===0){t.preventDefault();t.stopPropagation();h.call(this,t,true)}};v=function(t){if(t.originalEvent.attrName==="aria-expanded"&&t.originalEvent.newValue==="false"&&e(t.target).hasClass(this.settings.openClass)){t.preventDefault();t.stopPropagation();h.call(this,t,true)}};m=function(t){clearTimeout(this.focusTimeoutID);e(t.target).addClass(this.settings.focusClass).on("click.accessible-megamenu",e.proxy(p,this));this.justFocused=!this.mouseFocused;this.mouseFocused=false;if(this.panels.filter("."+this.settings.openClass).length){h.call(this,t)}};g=function(n){this.justFocused=false;var r=this,i=e(n.target),s=i.closest("."+this.settings.topNavItemClass),o=false;i.removeClass(this.settings.focusClass).off("click.accessible-megamenu",e.proxy(p,this));if(t.cvox){r.focusTimeoutID=setTimeout(function(){t.cvox.Api.getCurrentNode(function(e){if(s.has(e).length){clearTimeout(r.focusTimeoutID)}else{r.focusTimeoutID=setTimeout(function(e,t,n){h.call(e,t,n)},275,r,n,true)}})},25)}else{r.focusTimeoutID=setTimeout(function(){h.call(r,n,true)},300)}};y=function(n){var r=this.constructor===o?this:l(this),i=r.settings,f=e(e(this).is("."+i.hoverClass+":tabbable")?this:n.target),c=r.menu,d=r.topnavitems,v=f.closest("."+i.topNavItemClass),m=c.find(":tabbable"),g=f.hasClass(i.panelClass)?f:f.closest("."+i.panelClass),y=g.find("."+i.panelGroupClass),b=f.closest("."+i.panelGroupClass),w,E=n.keyCode||n.which,S,x,T,N,C=false,k=s.keyMap[n.keyCode]||"",L,A=v.length===1&&g.length===0;if(f.is("input:focus, select:focus, textarea:focus, button:focus")){return}if(f.is("."+i.hoverClass+":tabbable")){e("html").off("keydown.accessible-megamenu")}switch(E){case s.ESCAPE:h.call(r,n,true);break;case s.DOWN:n.preventDefault();if(A){h.call(r,n);C=v.find("."+i.panelClass+" :tabbable:first").focus().length===1}else{C=m.filter(":gt("+m.index(f)+"):first").focus().length===1}if(!C&&t.opera&&opera.toString()==="[object Opera]"&&(n.ctrlKey||n.metaKey)){m=e(":tabbable");x=m.index(f);C=e(":tabbable:gt("+e(":tabbable").index(f)+"):first").focus().length===1}break;case s.UP:n.preventDefault();if(A&&f.hasClass(i.openClass)){h.call(r,n,true);w=d.filter(":lt("+d.index(v)+"):last");if(w.children("."+i.panelClass).length){C=w.children().attr("aria-expanded","true").addClass(i.openClass).filter("."+i.panelClass).attr("aria-hidden","false").find(":tabbable:last").focus()===1}}else if(!A){C=m.filter(":lt("+m.index(f)+"):last").focus().length===1}if(!C&&t.opera&&opera.toString()==="[object Opera]"&&(n.ctrlKey||n.metaKey)){m=e(":tabbable");x=m.index(f);C=e(":tabbable:lt("+e(":tabbable").index(f)+"):first").focus().length===1}break;case s.RIGHT:n.preventDefault();if(A){C=d.filter(":gt("+d.index(v)+"):first").find(":tabbable:first").focus().length===1}else{if(y.length&&b.length){C=y.filter(":gt("+y.index(b)+"):first").find(":tabbable:first").focus().length===1}if(!C){C=v.find(":tabbable:first").focus().length===1}}break;case s.LEFT:n.preventDefault();if(A){C=d.filter(":lt("+d.index(v)+"):last").find(":tabbable:first").focus().length===1}else{if(y.length&&b.length){C=y.filter(":lt("+y.index(b)+"):last").find(":tabbable:first").focus().length===1}if(!C){C=v.find(":tabbable:first").focus().length===1}}break;case s.TAB:x=m.index(f);if(n.shiftKey&&A&&f.hasClass(i.openClass)){h.call(r,n,true);w=d.filter(":lt("+d.index(v)+"):last");if(w.children("."+i.panelClass).length){C=w.children().attr("aria-expanded","true").addClass(i.openClass).filter("."+i.panelClass).attr("aria-hidden","false").find(":tabbable:last").focus()}}else if(n.shiftKey&&x>0){C=m.filter(":lt("+x+"):last").focus().length===1}else if(!n.shiftKey&&x<m.length-1){C=m.filter(":gt("+x+"):first").focus().length===1}else if(t.opera&&opera.toString()==="[object Opera]"){m=e(":tabbable");x=m.index(f);if(n.shiftKey){C=e(":tabbable:lt("+e(":tabbable").index(f)+"):last").focus().length===1}else{C=e(":tabbable:gt("+e(":tabbable").index(f)+"):first").focus().length===1}}if(C){n.preventDefault()}break;case s.SPACE:if(A){n.preventDefault();p.call(r,n)}break;default:clearTimeout(this.keydownTimeoutID);a+=k!==a?k:"";if(a.length===0){return}this.keydownTimeoutID=setTimeout(function(){a=""},u);if(A&&!f.hasClass(i.openClass)){m=m.filter("."+i.topNavItemClass+" > :tabbable")}else{m=v.find(":tabbable")}if(n.shiftKey){m=e(m.get().reverse())}for(x=0;x<m.length;x++){T=m.eq(x);if(T.is(f)){S=a.length===1?x+1:x;break}}L=new RegExp("^"+a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),"i");for(x=S;x<m.length;x++){T=m.eq(x);N=e.trim(T.text());if(L.test(N)){C=true;T.focus();break}}if(!C){for(x=0;x<S;x++){T=m.eq(x);N=e.trim(T.text());if(L.test(N)){T.focus();break}}}break}r.justFocused=false};b=function(t){if(e(t.target).is(":tabbable, :focusable, ."+this.settings.panelClass)){this.mouseFocused=true}this.mouseTimeoutID=setTimeout(function(){clearTimeout(this.focusTimeoutID)},1)};w=function(t){clearTimeout(this.mouseTimeoutID);e(t.target).addClass(this.settings.hoverClass);h.call(this,t);if(e(t.target).is(":tabbable")){e("html").on("keydown.accessible-megamenu",e.proxy(y,t.target))}};E=function(t){var n=this;e(t.target).removeClass(n.settings.hoverClass);n.mouseTimeoutID=setTimeout(function(){h.call(n,t,true)},250);if(e(t.target).is(":tabbable")){e("html").off("keydown.accessible-megamenu")}};S=function(t){var n=this.menu;if(t){e("html").off("mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu,  pointerup.outside-accessible-megamenu",d);n.find("[aria-expanded]."+this.settings.panelClass).off("DOMAttrModified.accessible-megamenu",v)}else{e("html").on("mouseup.outside-accessible-megamenu, touchend.outside-accessible-megamenu, mspointerup.outside-accessible-megamenu,  pointerup.outside-accessible-megamenu",e.proxy(d,this));n.find("[aria-expanded=true]."+this.settings.panelClass).on("DOMAttrModified.accessible-megamenu",e.proxy(v,this))}};return{constructor:o,init:function(){var t=this,n=this.settings,r=this.nav=e(this.element),i=this.menu=r.children().first(),s=this.topnavitems=i.children();r.attr("role","navigation");i.addClass(n.menuClass);s.each(function(r,i){var s,o;i=e(i);i.addClass(n.topNavItemClass);s=i.find(":tabbable:first");o=i.children(":not(:tabbable):last");c.call(t,s);if(o.length){c.call(t,o);s.attr({"aria-owns":o.attr("id"),"aria-controls":o.attr("id"),"role": "button","tabindex": 0,"aria-expanded":false});s.removeAttr("href");o.attr({role:"group","aria-expanded":false,"aria-hidden":true}).addClass(n.panelClass).not("[aria-labelledby]").attr("aria-labelledby",s.attr("id"))}});this.panels=i.find("."+n.panelClass);i.on("focusin.accessible-megamenu",":tabbable, :focusable, ."+n.panelClass,e.proxy(m,this)).on("focusout.accessible-megamenu",":tabbable, :focusable, ."+n.panelClass,e.proxy(g,this)).on("keydown.accessible-megamenu",e.proxy(y,this)).on("mouseover.accessible-megamenu",e.proxy(w,this)).on("mouseout.accessible-megamenu",e.proxy(E,this)).on("mousedown.accessible-megamenu",e.proxy(b,this));if(f){i.on("touchstart.accessible-megamenu",e.proxy(p,this))}i.find("hr").attr("role","separator")},getDefaults:function(){return this._defaults},getOption:function(e){return this.settings[e]},getAllOptions:function(){return this.settings},setOption:function(e,t,n){this.settings[e]=t;if(n){this.init()}}}}();e.fn[r]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+r)){e.data(this,"plugin_"+r,new o(this,t))}})};e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(n){return!!e.data(n,t)}}):function(t,n,r){return!!e.data(t,r[3])},focusable:function(t){return a(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&a(t,!r)}})})(jQuery,window,document)